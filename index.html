<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù…ÙˆØ§Ø¯ÙÙƒ | Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #0e3d59; --accent: #d4af37; --bg: #f8fafb;
            --white: #ffffff; --green: #2ecc71; --red: #e74c3c;
            --text: #2c3e50; --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; direction: rtl; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--accent); position: sticky; top: 0; z-index: 1000; }
        .eng-section { background: #111; color: var(--accent); margin: 10px; padding: 10px; border-radius: 8px; text-align: center; font-size: 14px; font-weight: bold; }
        .tabs-container { display: flex; overflow-x: auto; background: white; padding: 12px; gap: 8px; box-shadow: var(--shadow); position: sticky; top: 65px; z-index: 999; }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn { background: #f0f2f5; border: none; padding: 8px 18px; border-radius: 20px; font-family: 'Cairo'; font-size: 12px; font-weight: bold; white-space: nowrap; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }
        .view-section { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid #eee; position: relative; }
        .card img { width: 100%; height: 120px; object-fit: cover; background: #eee; }
        .card-body { padding: 10px; }
        .p-name { font-size: 12px; font-weight: bold; height: 35px; overflow: hidden; }
        .p-price-num { color: var(--red); font-weight: 900; font-size: 15px; display: block; }
        .form-container, .auth-container { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); max-width: 500px; margin: 0 auto; }
        .input-group { margin-bottom: 15px; text-align: right; }
        .input-group label { display: block; font-size: 13px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 14px; border: 1px solid #e0e0e0; border-radius: 12px; font-family: 'Cairo'; outline: none; background: #fafafa; font-size: 14px; box-sizing: border-box; }
        .phone-input-container { display: flex; direction: ltr; gap: 5px; }
        .country-prefix { background: #eee; padding: 14px; border-radius: 12px; font-weight: bold; border: 1px solid #e0e0e0; }
        .btn-submit { background: var(--green); color: white; border: none; width: 100%; padding: 16px; border-radius: 12px; font-weight: 900; font-size: 16px; cursor: pointer; margin-top: 20px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; z-index: 2000; }
        .nav-item { text-align: center; font-size: 10px; color: #999; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item span { font-size: 20px; display: block; }
        .upload-area { border: 2px dashed var(--accent); padding: 20px; border-radius: 15px; cursor: pointer; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<header><h1>Ù…ÙˆØ§Ø¯ÙÙƒ <span>Ø§Ù„Ø¹Ø±Ø§Ù‚</span></h1></header>
<div class="eng-section">ğŸ“ Ù…Ù†ØµØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ø²Ø¨Ø§Ø¦Ù†</div>

<div id="homeView" class="view-section active">
    <div class="tabs-container" id="tabsMenu">
        <button class="tab-btn active" onclick="filterData('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="tab-btn" onclick="filterData('Ø¨Ù†Ø§Ø¡', this)">Ø¨Ù†Ø§Ø¡</button>
        <button class="tab-btn" onclick="filterData('ØªØ³Ù„ÙŠØ­', this)">ØªØ³Ù„ÙŠØ­</button>
        <button class="tab-btn" onclick="filterData('Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ', this)">Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ</button>
        <button class="tab-btn" onclick="filterData('ØµØ­ÙŠØ§Øª', this)">ØµØ­ÙŠØ§Øª</button>
        <button class="tab-btn" onclick="filterData('ÙƒÙ‡Ø±Ø¨Ø§Ø¡', this)">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</button>
    </div>
    <div class="grid" id="mainGrid" style="margin-top:15px;"></div>
</div>

<div id="supplierView" class="view-section">
    <div class="form-container">
        <h3>ğŸ“¥ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <select id="pCat"><option>Ø¨Ù†Ø§Ø¡</option><option>ØªØ³Ù„ÙŠØ­</option><option>Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ</option></select>
        <div class="upload-area" onclick="document.getElementById('pImgFile').click()">ğŸ“¸ Ø±ÙØ¹ ØµÙˆØ±Ø©
            <input type="file" id="pImgFile" hidden onchange="previewAndResizeImage(this)">
        </div>
        <img id="imagePreview" style="width:100%; display:none; border-radius:10px; margin-top:10px;">
        <button class="btn-submit" onclick="addProduct()">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚</button>
    </div>
</div>

<div id="authView" class="view-section">
    <div class="auth-container">
        <h3 id="authTitle" style="text-align:center;">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</h3>
        
        <div id="step-phone">
            <div class="input-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ</label>
                <div class="phone-input-container">
                    <span class="country-prefix">+964</span>
                    <input type="tel" id="userPhone" placeholder="77XXXXXXXX" style="direction: ltr;">
                </div>
            </div>
            <div id="recaptcha-container"></div>
            <button class="btn-submit" onclick="sendOTP()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ SMS</button>
        </div>

        <div id="step-otp" style="display:none;">
            <div class="input-group">
                <label>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…</label>
                <input type="number" id="otpCode" placeholder="000000">
            </div>
            <button class="btn-submit" style="background:var(--primary)" onclick="verifyOTP()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>

        <div id="step-profile" style="display:none;">
            <input type="text" id="userName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <select id="userCity"><option>Ø¨Ø§Ø¨Ù„</option><option>Ø¨ØºØ¯Ø§Ø¯</option><option>ÙƒØ±Ø¨Ù„Ø§Ø¡</option></select>
            <textarea id="userAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></textarea>
            <button class="btn-submit" onclick="saveProfile()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­ÙØ¸</button>
        </div>
    </div>
</div>

<div id="adminOrdersView" class="view-section">
    <h3>ğŸ“¥ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
    <div id="ordersList">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchView('homeView', this)"><span>ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="switchView('supplierView', this)"><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <div class="nav-item" onclick="switchView('adminOrdersView', this)"><span>ğŸ“‹</span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <div class="nav-item" onclick="switchView('authView', this)"><span>ğŸ‘¤</span>Ø­Ø³Ø§Ø¨ÙŠ</div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyA6PC-y6wO1Lv8Hjgi7B_B-iG0pM_D80_8", // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§ ÙƒØ§Ù…Ù„Ø§Ù‹
        authDomain: "hussain-e8703.firebaseapp.com",
        databaseURL: "https://hussain-e8703-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "hussain-e8703",
        storageBucket: "hussain-e8703.appspot.com",
        messagingSenderId: "1071985338140",
        appId: "1:1071985338140:web:968f86f76527b140da662e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±ÙŠÙƒØ§Ø¨ØªØ´Ø§
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });

    function sendOTP() {
        const rawPhone = document.getElementById('userPhone').value;
        const fullPhone = "+964" + rawPhone;
        auth.signInWithPhoneNumber(fullPhone, window.recaptchaVerifier)
            .then(result => {
                window.confirmationResult = result;
                document.getElementById('step-phone').style.display = 'none';
                document.getElementById('step-otp').style.display = 'block';
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­");
            }).catch(err => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + err.message));
    }

    function verifyOTP() {
        const code = document.getElementById('otpCode').value;
        window.confirmationResult.confirm(code)
            .then(() => {
                document.getElementById('step-otp').style.display = 'none';
                document.getElementById('step-profile').style.display = 'block';
            }).catch(() => alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦"));
    }

    function saveProfile() {
        const acc = {
            name: document.getElementById('userName').value,
            phone: "+964" + document.getElementById('userPhone').value,
            city: document.getElementById('userCity').value,
            addr: document.getElementById('userAddress').value
        };
        db.ref('users/' + acc.phone.replace('+', '')).set(acc).then(() => {
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            location.reload();
        });
    }

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    function switchView(id, btn) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    // Ø¶ØºØ· ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ±
    let tempImg = "";
    function previewAndResizeImage(input) {
        if (input.files && input.files[0]) {
            let reader = new FileReader();
            reader.onload = e => {
                let img = new Image();
                img.onload = () => {
                    let canvas = document.createElement('canvas');
                    canvas.width = 400; canvas.height = 300;
                    canvas.getContext('2d').drawImage(img, 0, 0, 400, 300);
                    tempImg = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('imagePreview').src = tempImg;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addProduct() {
        const n = document.getElementById('pName').value;
        const p = document.getElementById('pPrice').value;
        if(n && p && tempImg) {
            db.ref('products').push({name:n, price:p, img:tempImg, cat:document.getElementById('pCat').value})
            .then(() => alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!"));
        } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©"); }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    db.ref('products').on('value', s => {
        const data = s.val();
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data ? Object.keys(data).map(k => `
            <div class="card">
                <img src="${data[k].img}">
                <div class="card-body">
                    <div class="p-name">${data[k].name}</div>
                    <span class="p-price-num">${data[k].price} Ø¯.Ø¹</span>
                </div>
            </div>
        `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
    });
</script>
</body>
</html>
